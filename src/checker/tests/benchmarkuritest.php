<?php
/**
 * checkerBenchmarkUriTest Class PHP File
 * Created on January, the 12th 2010 at 21:26:14 by ronan
 *
 * @copyright Copyright (C) 2011 Ronan Guilloux. All rights reserved.
 * @license http://www.gnu.org/licenses/agpl.html GNU AFFERO GPL v3
 * @version //autogen//
 * @author Ronan Guilloux - coolforest.net
 * @package WebCheckerTests
 * @filesource benchmarkpathtest.php
 */

/**
 * Test class for checkerBenchmark
 * Generated by PHPUnit on 2011-01-12 at 23:50:17.
 *
 * @package WebCheckerTests
 * @version //autogen//
 * @codeCoverageIgnore
 */
class checkerBenchmarkUriTest extends PHPUnit_Framework_TestCase
{

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     *
     * @group WebCheckerTests
     */
    protected function setUp()
    {
        $this->object = new checkerBenchmarkUri();
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown()
    {
    }

    /**
     * @group WebCheckerTests
     */
    public function testSet()
    {
        $this->object->options = array();
        $this->object->password = '';
        $this->object->password = '%$foo$Bar!';
    }

    /**
     * @group WebCheckerTests
     */
    public function testGet()
    {
        $this->object->options = array();
        $foo = $this->object->options;
        $this->object->password = '%$foo$Bar!';
        $bar = $this->object->password;
    }

    /**
     * @expectedException ezcBasePropertyNotFoundException
     * @group WebCheckerTests
     */
    public function testGetException()
    {
        $foo = $this->object->bar;
    }

    /**
     * @expectedException ezcBaseValueException
     * @group WebCheckerTests
     */
    public function testSetException_1()
    {
        $this->object->options = -1;
    }

    /**
     * @expectedException ezcBaseValueException
     * @group WebCheckerTests
     */
    public function testSetException_2()
    {
        $this->object->url = new ezcUrl(); // string excepted
    }

    /**
     * @expectedException ezcBaseValueException
     * @group WebCheckerTests
     */
    public function testSetException_3()
    {
        $this->object->validateUrl = 'foo'; // string excepted
    }

    /**
     * @expectedException ezcBaseValueException
     * @group WebCheckerTests
     */
    public function testSetException_4()
    {
        $this->object->password = new ArrayObject( array() );
    }

    /**
     * @expectedException ezcBasePropertyNotFoundException
     * @group WebCheckerTests
     */
    public function testSetException_5()
    {
        $this->object->foo = 'bar';
    }

    /**
     * @expectedException ezcBaseValueException
     * @group WebCheckerTests
     */
    public function testSetException_6()
    {
        $this->object->expectedStrings = -1;
    }

    /**
     * @expectedException ezcBaseValueException
     * @group WebCheckerTests
     */
    public function testSetException_7()
    {
        $this->object->notExpectedStrings = 'foo:bar';
    }

    /**
     * @group WebCheckerTests
     */
    public function testIsset()
    {
        $this->object->options = array();
        $this->assertTrue(isset($this->object->options));
    }

    /**
     * @group WebCheckerTests
     */
    public function testRun_1()
    {
        $options = $this->fillOptions( 1 );
        $this->object->setUp($options);
        $result = $this->object->run();
        //var_export($result);
        $this->assertTrue( $result['result'] );

        // tracing :

        //        var_export( "\n" . $result['headerSent'] );
        //        var_export( "\n" . $result['lastUrl'] );
        //        var_export( "\n" . $result['lastUrl'] );
        //        var_export( "\n" . $result['code'] );
        //        var_export( "\n" . $result['contentType'] );
        //        var_export( "\n" . $result['contentLength'] );
        //        var_export( "\n" . $result['fileTime'] );
        //        var_export( "\n" . $result['content'] );

        //        // Specify configuration
        //        $config = array(
        //           'indent'         => true,
        //           'output-xhtml'   => true,
        //           'wrap'           => 200
        //        );
        //
        //        // Tidy
        //        $tidy = new tidy;
        //        $tidy->parseString( $result['content'], $config, 'utf8' );
        //        // $tidy->cleanRepair();// => no xhtml error output plz
        //        // Output
        //        var_export( $tidy );

        if( isset( $options['expectedStrings'] ) )
        {
            foreach( $options['expectedStrings'] as $expected )
            {
                $this->assertNotEquals(false, strpos($result['content'], str_replace('  ', '', trim($expected) ) ) );
            }
        }
        if( isset( $options['notExpectedStrings'] ) )
        {
            foreach( $options['notExpectedStrings'] as $notExpected )
            {
                $this->assertFalse(strpos($result['content'], str_replace('  ', '', trim($notExpected) ) ) );
            }
        }
    }

    /**
     * @expectedException ezcUrlException
     * @group WebCheckerTests
     */
    public function testRunException_2()
    {
        $options = $this->fillOptions( 2 );
        $this->object->setUp($options);
        $result = $this->object->run();
    }

    /**
     * @expectedException ezcUrlException
     * @group WebCheckerTests
     */
    public function testRunException_3()
    {
        $options = $this->fillOptions( 3 );
        $this->object->setUp($options);
        $result = $this->object->run();
    }

    /**
     * @expectedException ezcUrlException
     * @group WebCheckerTests
     */
    public function testRun_4()
    {
        $options = $this->fillOptions( 4 );
        $this->object->setUp($options);
        $result = $this->object->run();
    }

    /**
     * @expectedException ezcUrlException
     * @group WebCheckerTests
     */
    public function testRun_5()
    {
        $options = $this->fillOptions( 5 );
        $this->object->setUp($options);
        $result = $this->object->run();
    }

    /**
     * @group WebCheckerTests
     */
    public function testRunException_6()
    {
        $options = $this->fillOptions( 6 );
        $this->object->setUp($options);
        $result = $this->object->run();
    }

    /**
     * @group WebCheckerTests
     */
    public function testRunException_7()
    {
        $options = $this->fillOptions( 7 );
        $this->object->setUp($options);
        $result = $this->object->run();
    }

    /**
     * @group WebCheckerTests
     */
    public function testRunException_8()
    {
        $options = $this->fillOptions( 8 );
        $this->object->setUp($options);
        $result = $this->object->run();
        if( isset( $options['notExpectedStrings'] ) )
        {
            foreach( $options['notExpectedStrings'] as $notExpected )
            {
                $this->assertFalse(strpos($result['content'], str_replace('  ', '', trim($notExpected) ) ) );
            }
        }
    }

    protected function fillOptions($index)
    {
        switch ( $index )
        {
            case 1 :
                return array(
                	'scheme' => 'http',
                	'host' => 'incubator.apache.org',        	
                	'basedir' => array(),
                    'path' => array('zetacomponents','documentation', 'overview.html'),
                	'query' => '',
                	'validateUrl' => true,
                    'expectedStrings' => array( 'Apache Zeta Components' ),
                	'notExpectedStrings' => array( 'This must not be' ),
                );
                break;
            case 2 :
                return array(
                	'scheme' => 'htp',
                	'host' => 'foo:bar',        	
                	'basedir' => array(),
                    'path' => array(),
                	'query' => '',
                	'validateUrl' => true,
                );
                break;
            case 3 :
                return array(
                	'scheme' => null,
                	'host' => 'foo:bar',        	
                	'basedir' => array(),
                    'path' => array(),
                	'query' => '',
                	'validateUrl' => true,
                );
                break;
            case 4 :
                return array(
                	'scheme' => 'http',
                	'host' => '92.243.31.245',        	
                	'basedir' => array(),
                    'path' => array( 'phpUnitStubs', 'hidden', 'index.html' ),
                	'query' => '',
                	'validateUrl' => true,
                    'expectedStrings' => array( "Didn't got it !" ),
                );
                break;
            case 5 :
                return array(
                	'scheme' => 'http',
                	'host' => '92.243.31.245',        	
                	'basedir' => array(),
                    'path' => array( 'phpUnitStubs', 'hidden', 'index.html' ),
                	'query' => '',
                	'validateUrl' => true,
                    'password' => 'null:null',
                	'expectedStrings' => array( 'Error' ),
                );
                break;
            case 6:
                return array(
                	'scheme' => 'http',
                	'host' => '92.243.31.245',        	
                	'basedir' => array(),
                    'path' => array( 'phpUnitStubs', 'hidden', 'index.html' ),
                	'query' => '',
                	'validateUrl' => true,
                    'password' => 'login:password',
                );
                break;
            case 7 :
                return array(
                	'scheme' => 'http',
                	'host' => '92.243.31.245',        	
                	'basedir' => array(),
                    'path' => array( 'phpUnitStubs', 'hidden', 'index.html' ),
                	'query' => '',
                	'validateUrl' => true,
                    'password' => 'login:password',
                	'expectedStrings' => array( 'Got it !' ),
                );
                break;
            case 8 :
                return array(
                	'scheme' => 'http',
                	'host' => '92.243.31.245',        	
                	'basedir' => array(),
                    'path' => array( 'phpUnitStubs', 'hidden', 'index.html' ),
                	'query' => '',
                	'validateUrl' => true,
                    'password' => 'login:password',
                	'expectedStrings' => array( "Didn't got it !" ),
                );
                break;
        }
        return array();
    }

}
?>
